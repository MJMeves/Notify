<!DOCTYPE html>
<html>
<head>
  <title>Notify</title>
</head>
<body>
  <nav>
    <ul>
      <li><a href="queries.html">5 Queries</a></li>
    </ul>
  </nav>
  
  <h1>Notify Login</h1>

  <!-- Login form -->
  <div id="login">
    <div>
      <label for="loginId">Login ID:</label>
      <input id="loginId" type="number" min="1" step="1" />
    </div>
    <div>
      <label for="password">Password:</label>
      <input id="password" type="password" autocomplete="current-password" />
    </div>
    <div>
      <button id="loginBtn">Login</button>
    </div>
    <div
      id="loginStatus"
      role="status"
      aria-live="polite"
      style="margin-top:8px;color:#b00"
    ></div>
  </div>

  <script>
    document.getElementById("loginBtn").onclick = async () => {
      const loginId = document.getElementById("loginId").value.trim();
      const password = document.getElementById("password").value.trim();
      const statusEl = document.getElementById("loginStatus");

      statusEl.style.color = "#000";

      if (!loginId || !password) {
        statusEl.textContent = "Please enter both Login ID and password.";
        statusEl.style.color = "#b00";
        return;
      }

      statusEl.textContent = "Checking credentials...";

      try {
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ loginId, password })
        });

        let data;
        try {
          data = await res.json();
        } catch (_) {
          data = null;
        }

        if (!res.ok || !data || !data.success) {
          const msg =
            (data && data.message) ||
            res.statusText ||
            "Login failed for unknown reason.";
          statusEl.textContent = "Login failed: " + msg;
          statusEl.style.color = "#b00";
          return;
        }

        // Success
        statusEl.textContent = "Login successful.";
        statusEl.style.color = "#080";

        // Redirect based on role returned by server
        if (data.role === "artist") {
          window.location.href = "artist.html";
        } else if (data.role === "listener") {
          window.location.href = "listener.html";
        } else {
          // Fallback if server didn't send a role for some reason
          statusEl.textContent =
            "Login succeeded, but role is unknown. Please contact support.";
          statusEl.style.color = "#b00";
        }
      } catch (err) {
        statusEl.textContent = `Error: ${err.message}`;
        statusEl.style.color = "#b00";
      }
    };
  </script>
</body>
</html>
